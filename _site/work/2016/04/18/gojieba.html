<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
    <head>
        <meta charset="utf-8">
        <meta property="wb:webmaster" content="f97b0cc1aaecb801" />

        <!-- 百度站内搜索 -->
        <meta name="baidu-site-verification" content="VYH77GDc5e" />
        <!-- 百度站内搜索 -->

        <title>Golang版结巴中文分词『GoJieba』</title>
        <!--<meta name="viewport" content="width=device-width, initial-scale=1" />-->
        <!--<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />-->

        <link rel="stylesheet" href="/css/highlight7.1.default.min.css">
        <script src="/js/highlight7.1.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <link rel="stylesheet" href="/css/style.css">

        <!--
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-49284793-2', 'yanyiwu.com');
          ga('send', 'pageview');

        </script>
        -->

        <!-- picture -->
        <!--
        <script type="text/javascript" src="/js/pic.js"> </script>
        -->

        <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>

    </head>
    <body>
        <nav>
            <ul>
                <li onclick="location.href='/'">『首页』</li>
                <li onclick="location.href='/moment.html'">『时间线』</li>
                <li onclick="location.href='/discover.html'">『发现』</li>
                <li onclick="location.href='/about.html'">『关于·我』</li>
            </ul>
        </nav> 
        <div class="blog_index">
            <div id="logo">
                <a href="https://github.com/yanyiwu">
                    <img src="/img/github_logo.jpg"/>
                </a>
                <a href="http://weibo.com/buptwyy">
                    <img src="/img/weibo_logo.jpg"/>
                </a>
                <a href="http://7viirv.com1.z0.glb.clouddn.com/qrcodes_yanyiwu_personal.jpg">
                    <img src="/img/wechat_logo.jpg"/>
                </a>
                <a href="http://www.zhihu.com/people/yanyiwu.com">
                    <img src="/img/zhihu_logo.jpg" />
                </a>
                <a href="/rss.xml">
                    <img src="/img/rss_logo.jpg"/>
                </a>
            </div>
            <div>
                <div>
<h1 class="post_title">
    Golang版结巴中文分词『GoJieba』
</h1>

<div class="post_date">
    18 Apr 2016
</div>

<div class="blog_post">
    <p><center>
<img src="http://7viirv.com1.z0.glb.clouddn.com/GoJieBaLogo-v2.png" class="photo", style="width:80%"></img>
</center></p>

<h2 id=">前言</h2>

<p>是时候正式写一篇文章专门介绍一下 <a href="https://github.com/yanyiwu/gojieba">GoJieba</a> 了，
因为之后有打算基于 <a href="https://github.com/yanyiwu/gojieba">GoJieba</a> 对于 nlp / 搜索引擎等领域好好做一些 Go语言的轮子开发。 
Go语言目前来说，轮子还是偏少。 
毕竟，轮子越多，社区才能越繁荣。
也欢迎对此也感兴趣的朋友能联系<a href="http://yanyiwu.com/about.html">我</a>，互通有无。</p>

<p>本文基于 <a href="https://github.com/yanyiwu/gojieba">GoJieba</a> v0.13.0 版本。</p>

<p><a href="https://github.com/yanyiwu/gojieba">GoJieba</a>是&quot;结巴&quot;中文分词的Golang语言版本。</p>

<h2 id=">关键字</h2>

<p>Go(golang), 中文分词, 结巴(Jieba)中文分词, GoJieba </p>

<h2 id=">简介</h2>

<ul>
<li>支持多种分词方式，包括: 最大概率模式, HMM新词发现模式, 搜索引擎模式, 全模式</li>
<li>核心算法底层由C++实现，性能高效。</li>
<li>无缝集成到 <a href="https://github.com/blevesearch/bleve">bleve</a> 到进行搜索引擎的中文分词功能。</li>
<li>字典路径可配置，NewJieba(&hellip;string), NewExtractor(&hellip;string) 可变形参，当参数为空时使用默认词典(推荐方式)</li>
</ul>

<h2 id=">用法</h2>
<div class="highlight"><pre><code class="language-" data-lang="">go get github.com/yanyiwu/gojieba
</code></pre></div>
<p>分词示例</p>
<div class="highlight"><pre><code class="language-" data-lang="">package main

import (
    "fmt"
    "strings"

    "github.com/yanyiwu/gojieba"
)

func main() {
    var s string
    var words []string
    use_hmm := true
    x := gojieba.NewJieba()
    defer x.Free()

    s = "我来到北京清华大学"
    words = x.CutAll(s)
    fmt.Println(s)
    fmt.Println("全模式:", strings.Join(words, "/"))

    words = x.Cut(s, use_hmm)
    fmt.Println(s)
    fmt.Println("精确模式:", strings.Join(words, "/"))

    s = "他来到了网易杭研大厦"
    words = x.Cut(s, use_hmm)
    fmt.Println(s)
    fmt.Println("新词识别:", strings.Join(words, "/"))

    s = "小明硕士毕业于中国科学院计算所，后在日本京都大学深造"
    words = x.CutForSearch(s, use_hmm)
    fmt.Println(s)
    fmt.Println("搜索引擎模式:", strings.Join(words, "/"))

    s = "长春市长春药店"
    words = x.Tag(s)
    fmt.Println(s)
    fmt.Println("词性标注:", strings.Join(words, ","))
}
</code></pre></div>
<p>运行结果：</p>
<div class="highlight"><pre><code class="language-" data-lang="">我来到北京清华大学
全模式: 我/来到/北京/清华/清华大学/华大/大学
我来到北京清华大学
精确模式: 我/来到/北京/清华大学
他来到了网易杭研大厦
新词识别: 他/来到/了/网易/杭研/大厦
小明硕士毕业于中国科学院计算所，后在日本京都大学深造
搜索引擎模式: 小明/硕士/毕业/于/中国/中国科学院/科学/科学院/学院/计算所/，/后/在/日本/日本京都大学/京都/京都大学/大学/深造
长春市长春药店
词性标注: 长春市/ns,长春/ns,药店/n
</code></pre></div>
<h2 id="bleve">Bleve 中文分词插件用法</h2>
<div class="highlight"><pre><code class="language-" data-lang="">package main

import (
    "fmt"
    "os"

    "github.com/blevesearch/bleve"
    "github.com/yanyiwu/gojieba"
    _ "github.com/yanyiwu/gojieba/bleve"
)

func Example() {
    INDEX_DIR := "gojieba.bleve"
    messages := []struct {
        Id   string
        Body string
    }{
        {
            Id:   "1",
            Body: "你好",
        },
        {
            Id:   "2",
            Body: "世界",
        },
        {
            Id:   "3",
            Body: "亲口",
        },
        {
            Id:   "4",
            Body: "交代",
        },
    }

    indexMapping := bleve.NewIndexMapping()
    os.RemoveAll(INDEX_DIR)
    // clean index when example finished
    defer os.RemoveAll(INDEX_DIR)

    err := indexMapping.AddCustomTokenizer("gojieba",
        map[string]interface{}{
            "dictpath":     gojieba.DICT_PATH,
            "hmmpath":      gojieba.HMM_PATH,
            "userdictpath": gojieba.USER_DICT_PATH,
            "type":         "gojieba",
        },
    )
    if err != nil {
        panic(err)
    }
    err = indexMapping.AddCustomAnalyzer("gojieba",
        map[string]interface{}{
            "type":      "gojieba",
            "tokenizer": "gojieba",
        },
    )
    if err != nil {
        panic(err)
    }
    indexMapping.DefaultAnalyzer = "gojieba"

    index, err := bleve.New(INDEX_DIR, indexMapping)
    if err != nil {
        panic(err)
    }
    for _, msg := range messages {
        if err := index.Index(msg.Id, msg); err != nil {
            panic(err)
        }
    }

    querys := []string{
        "你好世界",
        "亲口交代",
    }

    for _, q := range querys {
        req := bleve.NewSearchRequest(bleve.NewQueryStringQuery(q))
        req.Highlight = bleve.NewHighlight()
        res, err := index.Search(req)
        if err != nil {
            panic(err)
        }
        fmt.Println(res)
    }
}

func main() {
    Example()
}
</code></pre></div>
<p>运行结果：</p>
<div class="highlight"><pre><code class="language-" data-lang="">2 matches, showing 1 through 2, took 360.584µs
    1. 2 (0.423287)
    Body
        &lt;mark&gt;世界&lt;/mark&gt;
    2. 1 (0.423287)
    Body
        &lt;mark&gt;你好&lt;/mark&gt;

2 matches, showing 1 through 2, took 131.055µs
    1. 4 (0.423287)
    Body
        &lt;mark&gt;交代&lt;/mark&gt;
    2. 3 (0.423287)
    Body
        &lt;mark&gt;亲口&lt;/mark&gt;
</code></pre></div>
<h2 id=">性能评测</h2>

<p><a href="http://yanyiwu.com/work/2015/06/14/jieba-series-performance-test.html">Jieba中文分词系列性能评测</a></p>

<h2 id=">测试</h2>

<p>Unittest</p>
<div class="highlight"><pre><code class="language-" data-lang="">go test ./...
</code></pre></div>
<p>Benchmark</p>
<div class="highlight"><pre><code class="language-" data-lang="">go test -bench "Jieba" -test.benchtime 10s
go test -bench "Extractor" -test.benchtime 10s
</code></pre></div>
<h2 id=">最后</h2>

<p>不知道这次的雄心壮志是否又会最后变成『挖坑不填』，
但是，至少也算是起了个头，一年来再回头看看，是否真的有所建树。</p>

<center>
<img src="http://7viirv.com1.z0.glb.clouddn.com/qrcodes_yanyiwu_public.jpg" class="photo" style="width:60%"></img>
</center>
<p>转载请注明出处: <a href="http://yanyiwu.com/work/2016/04/18/gojieba.html">Golang版结巴中文分词『GoJieba』</a></p>
</div>

</div>

<div class="review">

<!-- 百度分享按钮 start -->
<!--
<div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"24"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
-->
<!-- 百度分享按钮 end -->


<!-- 微博分享按钮 start -->
<!--
<wb:share-button addition="simple" type="button" ralateUid="1644441707"></wb:share-button>
-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="/work/2016/04/18/gojieba" data-title="Golang版结巴中文分词『GoJieba』" data-url="yanyiwu.com/work/2016/04/18/gojieba.html">
</div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yanyiwu"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->


</div>

            </div>
        </div>
        <!--kaiyi i love u so much-->
        <footer id="footer">
            <p>
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253065108'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253065108' type='text/javascript'%3E%3C/script%3E"));</script>
                <a href="http://www.miitbeian.gov.cn/">京ICP备14020698号</a>
            </p>
        </footer>
    </body>
</html>
